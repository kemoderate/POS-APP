<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <script
      src="https://kit.fontawesome.com/6ea2cb925f.js"
      crossorigin="anonymous"
    ></script>
    <title>POS - Users</title>

    <!-- Custom fonts for this template-->
    <link href="/sbadmin/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />

    <!-- Custom styles for this template-->
    <link href="/sbadmin/css/sb-admin-2.min.css" rel="stylesheet">
     <!-- Custom styles for this page -->
     <link rel="stylesheet" href="/sbadmin/stylesheets/dataTables.bootstrap4.min.css" />
     <style>
      .hidden {
        display: none;
      }
    </style>
  </head>

  <body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <%- include('partials/sidebar.ejs') %>
      <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <%- include('partials/topbar.ejs', { name: name }) %>
          <!-- End of Topbar -->
        <div class="container-fluid">
          <!-- Begin Page Content -->
          <h1 class="h3 mb-2 text-gray-800">Users</h1>
          <h5>This is data of Users</h5>
          <div class="card shadow mb-4">
            <div class="card-header py-3">
                <a href="/users/add" class="btn btn-primary btn-icon-split">
                  <span class="icon text-white-50">
                    <i class="fa-solid fa-plus"></i>
                  </span>
                  <span class="text">Add</span>
              </a>
            </div>
            <div id="userList" class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="example" width="100%" cellspacing="0">
                      <thead>
                        <tr>
                          <th>
                            <a href="/users?sortby=userid&sortorder=<%= sortDir === 'asc' && sortBy === 'userid' ? 'desc' : 'asc' %>">
                              User ID
                              <% if (sortBy === 'userid') { %>
                                <% if (sortDir === 'asc') { %>
                                  <i class="fas fa-sort-up"></i>
                                <% } else { %>
                                  <i class="fas fa-sort-down"></i>
                                <% } %>
                              <% } %>
                            </a>
                          </th>
                          <th>
                            <a href="/users?sortby=email&sortorder=<%= sortDir === 'asc' && sortBy === 'email' ? 'desc' : 'asc' %>">
                              Email
                              <% if (sortBy === 'email') { %>
                                <% if (sortDir === 'asc') { %>
                                  <i class="fas fa-sort-up"></i>
                                <% } else { %>
                                  <i class="fas fa-sort-down"></i>
                                <% } %>
                              <% } %>
                            </a>
                          </th>
                          <th>
                            <a href="/users?sortby=name&sortorder=<%= sortDir === 'asc' && sortBy === 'name' ? 'desc' : 'asc' %>">
                              Name
                              <% if (sortBy === 'name') { %>
                                <% if (sortDir === 'asc') { %>
                                  <i class="fas fa-sort-up"></i>
                                <% } else { %>
                                  <i class="fas fa-sort-down"></i>
                                <% } %>
                              <% } %>
                            </a>
                          </th>
                          <th>
                            <a href="/users?sortby=role&sortorder=<%= sortDir === 'asc' && sortBy === 'role' ? 'desc' : 'asc' %>">
                              Role
                              <% if (sortBy === 'role') { %>
                                <% if (sortDir === 'asc') { %>
                                  <i class="fas fa-sort-up"></i>
                                <% } else { %>
                                  <i class="fas fa-sort-down"></i>
                                <% } %>
                              <% } %>
                            </a>
                          </th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% let counter = 1; %>
                        <% data.forEach((user) => { %>
                        <tr align="left">
                          <td><%= counter %></td>
                          <td class="hidden"><%= user.userid %></td>
                              <td><%= user.email%></td>
                              <td><%= user.name%></td>
                              <td><%= user.role%></td>
                              <td>
                                <a class="btn btn-success btn-circle" href="/users/edit/<%= user.userid %>">
                                  <span class="icon text-white-50">
                                    <i class="fas fa-info-circle"></i>
                                  </span>
                                </a>
                              <a class="btn btn-danger btn-circle delete-btn" href="#" data-id="<%= user.userid %>" data-toggle="modal" data-target="#deleteModal">
                                <span class="icon text-white-50">
                                  <i class="fas fa-trash"></i>
                                </span>
                              </a>
                              </td>
                            </tr>
                            <% counter++; %>
                        <% }) %>
                      </tbody>
                      <tfoot>
                          <tr>
                              <th>User ID</th>
                              <th>Email</th>
                              <th>Name</th>
                              <th>Role</th>
                              <th>Action</th>
                          </tr>
                      </tfoot>
                      
                  </table>
                </div>
            </div>
        </div>
    </div>
          <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <%- include('partials/footer.ejs') %>
        <!-- End of Footer -->
      </div>
      <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>
 <!-- delete Modal-->
 <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
 aria-hidden="true">
 <div class="modal-dialog" role="document">
     <div class="modal-content">
         <div class="modal-header">
             <h5 class="modal-title" id="exampleModalLabel">Deleted Confirmation</h5>
             <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                 <span aria-hidden="true">Ã—</span>
             </button>
         </div>
         <div class="modal-body">Are you sure, you want delete it?</div>
         <div class="modal-footer">
             <a class="btn btn-secondary" data-dismiss="modal">No</a>
             <a class="btn btn-primary" id="confirmDeleteBtn" href="/users">Yes</a>
         </div>
     </div>
 </div>
</div>
    <!-- Logout Modal-->
    <%- include('partials/logoutModal.ejs') %>

    <!-- Bootstrap core JavaScript-->
    <script src="/sbadmin/vendor/jquery/jquery.min.js"></script>
    <script src="/sbadmin/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/sbadmin/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/sbadmin/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="/javascripts/jquery.dataTables.min.js"></script>
    <script src="/javascripts/dataTables.bootstrap4.min.js"></script>
    <!-- Page level custom scripts -->
    <!-- <script src="/javascripts/datatables-demo.js"></script> -->
    <script>
      // Get the confirm delete button in the modal
      const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    
      // Attach click event listeners to each delete button
      const deleteButtons = document.querySelectorAll('.delete-btn');
      deleteButtons.forEach((button) => {
        button.addEventListener('click', (event) => {
          event.preventDefault();
    
          // Retrieve the user ID from the data-id attribute
          const userId = button.dataset.id;
    
          // Set the URL for the delete request
          confirmDeleteBtn.href = `/users/delete/${userId}`;
        });
      });
    </script>
     <script>
  $(document).ready(function () {
      $('#example').DataTable({
          "lengthMenu": [[3, 10, 100], [3, 10, "All"]],
          "processing": true,
          "serverSide": true,
          "ajax": "/datatable",
          "columns": [
              { "data": "userid" },
              { "data": "email" },
              { "data": "name" },
              { "data": "role" },
              {
                "render": function (data, type, row) {
                    return `
                        <td>
                            <a class="btn btn-success btn-circle" href="/users/edit/${row.userid}">
                                <span class="icon text-white-50">
                                    <i class="fas fa-info-circle"></i>
                                </span>
                            </a>
                            <a class="btn btn-danger btn-circle" href="#" data-toggle="modal" data-id="${row.userid}" data-target="#deleteModal">
                                <span class="icon text-white-50">
                                    <i class="fas fa-trash"></i>
                                </span>
                            </a>
                            <span></span>
                        </td>
                    `;
                }
            }
          ]
      });
  });
</script>
  </body>
</html>